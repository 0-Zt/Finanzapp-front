<section class="page-shell">
  <app-dashboard-hero
    [title]="title"
    [lastUpdated]="lastUpdated"
    [cards]="cards"
    [isLoading]="isLoading"
    (addTransaction)="onAddTransaction()"
    (viewReports)="onViewReports()"
  ></app-dashboard-hero>

  @if (errorMessage) {
    <div class="rounded-2xl border border-rose-200/70 bg-rose-50/80 px-5 py-4 text-sm text-rose-700 shadow-sm dark:border-rose-500/20 dark:bg-rose-500/10 dark:text-rose-200">
      {{ errorMessage }}
    </div>
  }

  <app-transaction-dialog
    [categories]="categories"
    [isOpen]="isFormOpen"
    [mode]="formMode"
    [transaction]="editingTransaction"
    (createTransaction)="onCreateTransaction($event)"
    (updateTransaction)="onUpdateTransaction($event)"
    (close)="onCloseTransactionForm()"
  ></app-transaction-dialog>

  <section id="reports" class="flex flex-col gap-4 sm:gap-6 lg:gap-8">
    @if (isLoading) {
      <!-- Skeleton para el grafico -->
      <div class="glass-card">
        <div class="flex flex-wrap items-start justify-between gap-6">
          <div class="flex flex-col gap-2">
            <div class="h-6 w-48 animate-pulse rounded bg-slate-200 dark:bg-slate-700"></div>
            <div class="h-4 w-64 animate-pulse rounded bg-slate-200 dark:bg-slate-700"></div>
          </div>
          <div class="flex gap-2">
            <div class="h-8 w-20 animate-pulse rounded-full bg-slate-200 dark:bg-slate-700"></div>
            <div class="h-8 w-20 animate-pulse rounded-full bg-slate-200 dark:bg-slate-700"></div>
          </div>
        </div>
        <div class="mt-8 flex items-end gap-5">
          @for (i of [1,2,3,4,5,6,7,8,9,10,11,12]; track i) {
            <div class="flex h-44 w-full flex-col items-center gap-3">
              <div class="flex h-full w-full items-end gap-1 rounded-2xl bg-slate-100 p-2 dark:bg-slate-800">
                <div class="w-1/2 animate-pulse rounded-t-xl bg-slate-200 dark:bg-slate-700" [style.height.%]="30 + (i * 5)"></div>
                <div class="w-1/2 animate-pulse rounded-t-xl bg-slate-200 dark:bg-slate-700" [style.height.%]="20 + (i * 4)"></div>
              </div>
              <div class="h-3 w-8 animate-pulse rounded bg-slate-200 dark:bg-slate-700"></div>
            </div>
          }
        </div>
      </div>

      <!-- Skeleton para transacciones -->
      <div class="glass-card">
        <div class="flex flex-wrap items-start justify-between gap-6">
          <div class="flex flex-col gap-2">
            <div class="h-6 w-40 animate-pulse rounded bg-slate-200 dark:bg-slate-700"></div>
            <div class="h-4 w-56 animate-pulse rounded bg-slate-200 dark:bg-slate-700"></div>
          </div>
        </div>
        <div class="mt-6 grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-6">
          @for (i of [1,2,3,4,5,6]; track i) {
            <app-skeleton-transaction></app-skeleton-transaction>
          }
        </div>
      </div>
    } @else {
      <app-monthly-performance-chart
        [data]="monthlyPerformance"
        [title]="reportPeriod === 'monthly' ? 'Comportamiento mensual' : 'Comportamiento anual'"
        [description]="
          reportPeriod === 'monthly'
            ? 'Comparativa de ingresos y gastos en los últimos 12 meses.'
            : 'Comparativa anual de ingresos y gastos.'
        "
        [period]="reportPeriod"
        (periodChange)="onReportPeriodChange($event)"
      ></app-monthly-performance-chart>

      <app-transactions-card
        [transactions]="transactions"
        [categories]="categories"
        [filters]="transactionFilters"
        [monthOptions]="monthOptions"
        [hasMore]="hasMoreTransactions"
        [actionLink]="'/transactions'"
        (filtersChange)="onFiltersChange($event)"
        (loadMore)="onLoadMoreTransactions()"
        (editTransaction)="onEditTransaction($event)"
        (deleteTransaction)="onDeleteTransaction($event)"
      ></app-transactions-card>
    }
  </section>

  <section class="grid gap-4 sm:gap-6 lg:grid-cols-2 lg:gap-8">
    @if (isLoading) {
      <!-- Skeleton para categorias -->
      <div class="glass-card">
        <div class="flex flex-wrap items-start justify-between gap-6">
          <div class="flex flex-col gap-2">
            <div class="h-6 w-40 animate-pulse rounded bg-slate-200 dark:bg-slate-700"></div>
            <div class="h-4 w-56 animate-pulse rounded bg-slate-200 dark:bg-slate-700"></div>
          </div>
        </div>
        <div class="mt-6 grid gap-6 sm:grid-cols-[200px_1fr]">
          <div class="mx-auto h-48 w-48 animate-pulse rounded-full bg-slate-200 dark:bg-slate-700"></div>
          <div class="flex flex-col gap-3">
            @for (i of [1,2,3,4,5]; track i) {
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="h-3 w-3 animate-pulse rounded-full bg-slate-200 dark:bg-slate-700"></div>
                  <div class="h-4 w-24 animate-pulse rounded bg-slate-200 dark:bg-slate-700"></div>
                </div>
                <div class="h-4 w-12 animate-pulse rounded bg-slate-200 dark:bg-slate-700"></div>
              </div>
            }
          </div>
        </div>
      </div>
      <!-- Skeleton para presupuestos -->
      <div class="glass-card">
        <div class="flex flex-wrap items-start justify-between gap-6">
          <div class="flex flex-col gap-2">
            <div class="h-6 w-40 animate-pulse rounded bg-slate-200 dark:bg-slate-700"></div>
            <div class="h-4 w-56 animate-pulse rounded bg-slate-200 dark:bg-slate-700"></div>
          </div>
        </div>
        <div class="mt-6 space-y-4">
          <div class="h-24 animate-pulse rounded-xl bg-slate-200 dark:bg-slate-700"></div>
          <div class="h-16 animate-pulse rounded-xl bg-slate-200 dark:bg-slate-700"></div>
        </div>
      </div>
    } @else {
      <app-category-breakdown
        [items]="categoryBreakdown"
        [title]="reportPeriod === 'monthly' ? 'Categorias del mes' : 'Categorias del ano'"
        [description]="
          reportPeriod === 'monthly'
            ? 'Distribución de gastos del mes actual.'
            : 'Distribución de gastos del año actual.'
        "
      ></app-category-breakdown>

      <app-budget-summary-card
        [summary]="budgetSummary"
      ></app-budget-summary-card>
    }
  </section>

  <!-- Credit Cards Section -->
  <section class="grid gap-4 sm:gap-6 lg:grid-cols-2 lg:gap-8">
    <app-credit-cards-widget
      [summary]="creditCardsSummary"
      [isLoading]="isCreditCardsLoading"
    ></app-credit-cards-widget>

    <!-- Tips/Suggestions card -->
    <article class="glass-card">
      <header>
        <h2 class="text-xl font-semibold text-slate-900 dark:text-white">Consejos financieros</h2>
        <p class="mt-1 text-sm text-slate-600 dark:text-slate-300">
          Recomendaciones para mejorar tu salud financiera.
        </p>
      </header>
      <ul class="mt-6 space-y-3">
        <li class="flex items-start gap-3 rounded-xl bg-slate-50/80 p-3 dark:bg-slate-800/30">
          <span class="mt-0.5 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-emerald-100 text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
            </svg>
          </span>
          <p class="text-sm text-slate-600 dark:text-slate-300">
            Paga el total de tu tarjeta de crédito para evitar intereses.
          </p>
        </li>
        <li class="flex items-start gap-3 rounded-xl bg-slate-50/80 p-3 dark:bg-slate-800/30">
          <span class="mt-0.5 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-emerald-100 text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
            </svg>
          </span>
          <p class="text-sm text-slate-600 dark:text-slate-300">
            Mantén la utilización de crédito bajo el 30% de tu límite.
          </p>
        </li>
        <li class="flex items-start gap-3 rounded-xl bg-slate-50/80 p-3 dark:bg-slate-800/30">
          <span class="mt-0.5 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-emerald-100 text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
            </svg>
          </span>
          <p class="text-sm text-slate-600 dark:text-slate-300">
            Revisa tus gastos semanalmente para mantener el control.
          </p>
        </li>
      </ul>
    </article>
  </section>
</section>

<!-- Floating Action Button for quick transaction add (mobile-friendly) -->
<app-transaction-fab></app-transaction-fab>
