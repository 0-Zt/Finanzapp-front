<section class="page-shell">
  <header class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-3xl font-semibold text-slate-900 dark:text-white">Metas financieras</h1>
      <p class="mt-2 text-sm text-slate-600 dark:text-slate-300">
        Administra metas, controla el avance y ajusta tus objetivos.
      </p>
    </div>
    <button type="button" class="primary-button" (click)="onOpenCreate()">Nueva meta</button>
  </header>

  @if (isLoading) {
    <div class="rounded-2xl border border-slate-200/70 bg-white/70 px-5 py-4 text-sm text-slate-600 shadow-sm dark:border-slate-800/70 dark:bg-slate-900/50 dark:text-slate-200">
      Cargando metas...
    </div>
  }

  @if (errorMessage) {
    <div class="rounded-2xl border border-rose-200/70 bg-rose-50/80 px-5 py-4 text-sm text-rose-700 shadow-sm dark:border-rose-500/20 dark:bg-rose-500/10 dark:text-rose-200">
      {{ errorMessage }}
    </div>
  }

  @if (isFormOpen) {
    <section class="glass-card">
      <header class="flex flex-wrap items-center justify-between gap-3">
        <div>
          <h2 class="text-xl font-semibold text-slate-900 dark:text-white">
            {{ formMode === 'edit' ? 'Editar meta' : 'Nueva meta' }}
          </h2>
          <p class="text-sm text-slate-600 dark:text-slate-300">
            Define el objetivo y la fecha limite.
          </p>
        </div>
        <button type="button" class="quiet-button" (click)="onCloseForm()">Cerrar</button>
      </header>

      <form class="mt-6 grid gap-4" (ngSubmit)="onSubmit()">
        <label class="flex flex-col gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
          Titulo
          <input
            type="text"
            name="title"
            required
            [(ngModel)]="formState.title"
            class="input-field"
            placeholder="Ej. Fondo de emergencia"
          />
        </label>

        <div class="grid gap-4 md:grid-cols-2">
          <label class="flex flex-col gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
            Monto actual
            <input
              type="number"
              name="currentAmount"
              min="0"
              step="0.01"
              [(ngModel)]="formState.currentAmount"
              class="input-field"
              placeholder="0.00"
            />
          </label>

          <label class="flex flex-col gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
            Monto objetivo
            <input
              type="number"
              name="targetAmount"
              required
              min="0"
              step="0.01"
              [(ngModel)]="formState.targetAmount"
              class="input-field"
              placeholder="0.00"
            />
          </label>
        </div>

        <label class="flex flex-col gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
          Fecha limite
          <input
            type="date"
            name="deadline"
            required
            [(ngModel)]="formState.deadline"
            class="input-field"
          />
        </label>

        <div class="flex flex-wrap gap-3">
          <button type="submit" class="primary-button">
            {{ formMode === 'edit' ? 'Guardar cambios' : 'Crear meta' }}
          </button>
          <button type="button" class="ghost-button" (click)="onCloseForm()">Cancelar</button>
        </div>
      </form>
    </section>
  }

  <section class="grid gap-6 md:grid-cols-[1.2fr_0.8fr]">
    <article class="glass-card">
      <header class="flex items-center justify-between">
        <div>
          <h2 class="text-xl font-semibold text-slate-900 dark:text-white">Metas activas</h2>
          <p class="mt-1 text-sm text-slate-600 dark:text-slate-300">
            {{ goals.length ? 'Resumen de tus objetivos actuales.' : 'No hay metas registradas.' }}
          </p>
        </div>
        <span class="filter-chip">{{ totalProgress }}% global</span>
      </header>

      @if (!goals.length) {
        <div class="mt-6 text-sm text-slate-500 dark:text-slate-300">
          Crea una meta para empezar a medir tu avance.
        </div>
      } @else {
        <ul class="mt-6 flex flex-col gap-4">
          @for (goal of goals; track goal.id) {
            <li class="list-card">
              <div class="flex flex-wrap items-start justify-between gap-3">
                <div>
                  <h3 class="text-base font-semibold text-slate-900 dark:text-white">{{ goal.title }}</h3>
                  <p class="text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400">
                    Limite {{ goal.deadline }}
                  </p>
                </div>
                <div class="flex items-center gap-2 text-xs font-semibold text-slate-500 dark:text-slate-400">
                  <button type="button" class="hover:text-brand-600" (click)="onEdit(goal)">Editar</button>
                  <span class="text-slate-300 dark:text-slate-700">|</span>
                  <button type="button" class="text-rose-500 hover:text-rose-400" (click)="onDelete(goal)">
                    Eliminar
                  </button>
                </div>
              </div>
              <div class="mt-3 flex flex-wrap items-center justify-between gap-3 text-sm">
                <span class="text-slate-600 dark:text-slate-300">
                  {{ goal.current_amount | number: '1.0-2' }} / {{ goal.target_amount | number: '1.0-2' }}
                </span>
                <span class="text-sm font-semibold text-slate-900 dark:text-white">
                  {{ progress(goal) }}%
                </span>
              </div>
              <div class="mt-2 h-2 w-full rounded-full bg-slate-200/80 dark:bg-slate-800/80">
                <span
                  class="block h-full rounded-full bg-emerald-400"
                  [style.width.%]="progress(goal)"
                ></span>
              </div>
            </li>
          }
        </ul>
      }
    </article>

    <article class="glass-card">
      <header class="flex items-center justify-between">
        <div>
          <h2 class="text-xl font-semibold text-slate-900 dark:text-white">Sugerencias</h2>
          <p class="mt-1 text-sm text-slate-600 dark:text-slate-300">
            Ideas r√°pidas para acelerar tus metas.
          </p>
        </div>
      </header>
      <ul class="mt-6 flex flex-col gap-3 text-sm text-slate-600 dark:text-slate-300">
        <li class="list-card text-sm text-slate-600 dark:text-slate-300">
          Automatiza un aporte mensual para mantener constancia.
        </li>
        <li class="list-card text-sm text-slate-600 dark:text-slate-300">
          Revisa tus metas cada trimestre y ajusta el objetivo.
        </li>
        <li class="list-card text-sm text-slate-600 dark:text-slate-300">
          Separa una meta para imprevistos y otra para inversiones.
        </li>
      </ul>
    </article>
  </section>
</section>
