<!-- Backdrop -->
<div class="fixed inset-0 z-40 animate-fade-in" (click)="closePanel()"></div>

<!-- Notification Panel -->
<div
  class="fixed sm:absolute right-2 sm:right-0 left-2 sm:left-auto top-16 sm:top-full sm:mt-2 w-auto sm:w-96 max-h-[75vh] overflow-hidden rounded-2xl border border-slate-200/60 bg-white shadow-2xl dark:border-slate-800/70 dark:bg-slate-900 z-50 animate-dropdown-in"
  (click)="$event.stopPropagation()"
>
  <!-- Header -->
  <div class="sticky top-0 z-10 flex items-center justify-between border-b border-slate-200/60 bg-white px-4 py-3 dark:border-slate-800/70 dark:bg-slate-900">
    <h3 class="font-semibold text-slate-900 dark:text-white">Notificaciones</h3>
    @if (unreadCount() > 0) {
      <button
        type="button"
        class="text-xs font-medium text-brand-600 hover:text-brand-700 dark:text-brand-400 dark:hover:text-brand-300 transition-colors"
        (click)="markAllAsRead()"
      >
        Marcar todas leidas
      </button>
    }
  </div>

  <!-- Content -->
  <div class="max-h-[calc(70vh-60px)] overflow-y-auto">
    @if (isLoading()) {
      <div class="flex items-center justify-center py-12">
        <div class="h-8 w-8 animate-spin rounded-full border-4 border-brand-600 border-t-transparent"></div>
      </div>
    } @else if (notifications().length === 0) {
      <!-- Empty State -->
      <div class="flex flex-col items-center justify-center py-16 text-slate-500 dark:text-slate-400 animate-fade-up">
        <svg class="mb-4 h-16 w-16 opacity-40" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="1.5"
            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
          />
        </svg>
        <p class="text-sm font-medium">No hay notificaciones</p>
        <p class="mt-1 text-xs">Te avisaremos cuando haya algo nuevo</p>
      </div>
    } @else {
      <!-- Notification List -->
      <div class="divide-y divide-slate-100 dark:divide-slate-800">
        @for (notification of notifications(); track notification.id; let i = $index) {
          <div class="animate-fade-up" [style.animation-delay.ms]="i * 50">
            <app-notification-item
              [notification]="notification"
              (read)="onRead($event)"
              (dismiss)="onDismiss($event)"
              (action)="onAction($event)"
            />
          </div>
        }
      </div>

      <!-- Load More -->
      @if (hasMore()) {
        <div class="border-t border-slate-100 p-3 dark:border-slate-800">
          <button
            type="button"
            class="w-full rounded-lg bg-slate-100 py-2 text-sm font-medium text-slate-600 transition-colors hover:bg-slate-200 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-slate-700"
            (click)="loadMore()"
          >
            Cargar mas
          </button>
        </div>
      }
    }
  </div>
</div>
