<article class="glass-card">
  <header class="flex flex-wrap items-start justify-between gap-4">
    <div>
      <h2 class="text-heading text-text-primary dark:text-text-primary-dark">{{ title }}</h2>
      <p class="mt-1 text-body-sm text-text-secondary dark:text-text-secondary-dark">
        {{ description }}
      </p>
    </div>
    <div class="flex items-center gap-3">
      @if (showFilters && monthOptions.length > 0) {
        <select
          class="filter-select"
          [ngModel]="filters.month"
          (ngModelChange)="onMonthChange($event)"
        >
          <option [ngValue]="'all'">Todos</option>
          @for (month of monthOptions; track month.value) {
            <option [ngValue]="month.value">{{ month.label }}</option>
          }
        </select>
      }
      <button type="button" class="quiet-button">
        {{ actionLabel }}
      </button>
    </div>
  </header>

  @if (!transactions.length) {
    <div class="empty-state mt-6">
      <span class="text-body-sm">No hay movimientos con estos filtros.</span>
    </div>
  } @else {
    <ul class="mt-6 grid gap-4 sm:grid-cols-2 xl:grid-cols-3">
      @for (transaction of transactions; track transaction.id; let i = $index) {
        <li
          class="list-card flex flex-col gap-3 animate-fade-up"
          [style.animation-delay.ms]="i * 40"
        >
          <div class="flex items-start justify-between gap-2">
            <div class="flex flex-col gap-1 min-w-0">
              <span class="text-subheading-sm text-text-primary dark:text-text-primary-dark truncate">
                {{ transaction.title }}
              </span>
              <span class="text-caption text-text-tertiary dark:text-text-tertiary-dark">
                {{ transaction.date }}
              </span>
            </div>
            <span
              class="text-body-sm font-bold whitespace-nowrap"
              [ngClass]="amountClass(transaction.type)"
            >
              {{ transaction.amount }}
            </span>
          </div>
          <div class="flex items-center justify-between gap-2">
            @if (transaction.categoryColor) {
              <span
                class="badge-soft border flex items-center gap-1.5 text-label-xs"
                [ngStyle]="categoryStyle(transaction)"
              >
                @if (transaction.categoryIcon) {
                  <app-category-icon
                    [icon]="transaction.categoryIcon"
                    [size]="12"
                    [ariaLabel]="transaction.category"
                  ></app-category-icon>
                } @else {
                  <span
                    class="h-1.5 w-1.5 rounded-full"
                    [ngStyle]="{ backgroundColor: transaction.categoryColor }"
                  ></span>
                }
                {{ transaction.category }}
              </span>
            } @else {
              <span
                class="rounded-full px-2 py-0.5 text-label-xs font-semibold flex items-center gap-1"
                [ngClass]="categoryClass(transaction.category)"
              >
                @if (transaction.categoryIcon) {
                  <app-category-icon
                    [icon]="transaction.categoryIcon"
                    [size]="12"
                    [ariaLabel]="transaction.category"
                  ></app-category-icon>
                }
                {{ transaction.category }}
              </span>
            }
            <div class="flex items-center gap-2 text-label text-text-tertiary dark:text-text-tertiary-dark">
              <button type="button" class="hover:text-brand-600 dark:hover:text-brand-400 transition-colors" (click)="editTransaction.emit(transaction)">
                Editar
              </button>
              <button type="button" class="text-status-danger/70 hover:text-status-danger dark:text-status-danger-dark/70 dark:hover:text-status-danger-dark transition-colors" (click)="deleteTransaction.emit(transaction)">
                Eliminar
              </button>
            </div>
          </div>
        </li>
      }
    </ul>
  }

  @if (hasMore) {
    <div class="mt-6 flex justify-center">
      <button type="button" class="quiet-button" (click)="loadMore.emit()">Ver mas</button>
    </div>
  }
</article>
