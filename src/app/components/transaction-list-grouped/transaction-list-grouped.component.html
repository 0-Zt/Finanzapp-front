@if (groups.length === 0 && !isLoading) {
  <div class="empty-state">
    <div class="empty-state-icon">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
      </svg>
    </div>
    <p class="empty-state-text">No hay transacciones con estos filtros</p>
    <p class="empty-state-hint">Intenta cambiar los filtros o agregar una nueva transacción</p>
  </div>
} @else {
  <div class="transaction-groups">
    @for (group of groups; track trackByGroupKey($index, group)) {
      <div class="transaction-group animate-fade-up" [style.animation-delay.ms]="$index * 80">
        <!-- Group Header -->
        <div class="group-header">
          <h3 class="group-title">{{ group.label }}</h3>
          <div class="group-stats">
            @if (group.totalIncome > 0) {
              <span class="stat-income">+{{ group.totalIncome | number:'1.0-0' }}</span>
            }
            @if (group.totalExpense > 0) {
              <span class="stat-expense">-{{ group.totalExpense | number:'1.0-0' }}</span>
            }
          </div>
        </div>

        <!-- Transactions List -->
        <ul class="transactions-list">
          @for (transaction of group.transactions; track trackByTransactionId($index, transaction)) {
            <li class="transaction-item">
              <!-- Mobile Layout (default) -->
              <div class="transaction-content">
                <div class="transaction-main">
                  <!-- Category Icon -->
                  <div class="transaction-icon" [ngStyle]="categoryStyle(transaction)">
                    @if (transaction.categoryIcon) {
                      <app-category-icon
                        [icon]="transaction.categoryIcon"
                        [size]="18"
                        [ariaLabel]="transaction.category"
                      ></app-category-icon>
                    } @else {
                      <span class="icon-fallback">{{ transaction.category.charAt(0) }}</span>
                    }
                  </div>

                  <!-- Info -->
                  <div class="transaction-info">
                    <span class="transaction-title">{{ transaction.title }}</span>
                    <span class="transaction-meta">
                      <span class="category-badge" [ngStyle]="categoryStyle(transaction)">
                        {{ transaction.category }}
                      </span>
                      <span class="separator">·</span>
                      <span>{{ transaction.date }}</span>
                    </span>
                  </div>
                </div>

                <!-- Amount & Actions -->
                <div class="transaction-end">
                  <span class="transaction-amount" [ngClass]="amountClass(transaction.type)">
                    {{ transaction.amount }}
                  </span>
                  <div class="transaction-actions">
                    <button
                      type="button"
                      class="action-btn edit"
                      title="Editar"
                      (click)="editTransaction.emit(transaction)"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                      </svg>
                    </button>
                    <button
                      type="button"
                      class="action-btn delete"
                      title="Eliminar"
                      (click)="deleteTransaction.emit(transaction)"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
            </li>
          }
        </ul>
      </div>
    }
  </div>

  <!-- Pagination -->
  @if (pagination.totalPages > 1) {
    <nav class="pagination" aria-label="Paginación">
      <button
        type="button"
        class="pagination-btn nav"
        [disabled]="pagination.currentPage === 1"
        (click)="onPrevPage()"
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
        </svg>
        <span class="sr-only sm:not-sr-only">Anterior</span>
      </button>

      <div class="pagination-pages">
        @for (page of visiblePages; track $index) {
          @if (page === -1) {
            <span class="pagination-ellipsis">...</span>
          } @else {
            <button
              type="button"
              class="pagination-btn page"
              [class.active]="page === pagination.currentPage"
              (click)="onPageClick(page)"
            >
              {{ page }}
            </button>
          }
        }
      </div>

      <button
        type="button"
        class="pagination-btn nav"
        [disabled]="pagination.currentPage === pagination.totalPages"
        (click)="onNextPage()"
      >
        <span class="sr-only sm:not-sr-only">Siguiente</span>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
        </svg>
      </button>
    </nav>

    <p class="pagination-info">
      Mostrando {{ (pagination.currentPage - 1) * pagination.pageSize + 1 }} -
      {{ pagination.currentPage * pagination.pageSize > pagination.totalItems ? pagination.totalItems : pagination.currentPage * pagination.pageSize }}
      de {{ pagination.totalItems }} transacciones
    </p>
  }
}
