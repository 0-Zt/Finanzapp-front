<article class="glass-card animate-fade-up h-full flex flex-col">
  <header class="flex flex-wrap items-start justify-between gap-4">
    <div>
      <h2 class="text-xl font-semibold text-slate-900 dark:text-white">{{ title }}</h2>
      <p class="mt-1 text-sm text-slate-600 dark:text-slate-300">
        {{ description }}
      </p>
    </div>
    <span class="filter-chip">Periodo actual</span>
  </header>

  @if (!items.length) {
    <div class="mt-6 text-sm text-slate-500 dark:text-slate-300 text-center">
      No hay gastos registrados en este periodo.
    </div>
  } @else {
    <div class="mt-6 flex flex-col items-center gap-6 flex-1">
      <!-- Pie Chart -->
      <div class="relative w-44 h-44">
        <svg viewBox="0 0 100 100" class="w-full h-full -rotate-90">
          @for (segment of segments; track segment.label) {
            <path
              [attr.d]="segment.path"
              [attr.fill]="segment.color"
              class="cursor-pointer transition-all duration-200 origin-center"
              [class.scale-105]="hoveredSegment === segment"
              [class.opacity-90]="hoveredSegment && hoveredSegment !== segment"
              (mouseenter)="onSegmentHover(segment)"
              (mouseleave)="onSegmentHover(null)"
            />
          }
          <!-- Inner circle for donut effect -->
          <circle cx="50" cy="50" r="28" class="fill-white dark:fill-slate-900" />
        </svg>

        <!-- Center content -->
        <div class="absolute inset-0 flex flex-col items-center justify-center text-center pointer-events-none">
          @if (hoveredSegment) {
            <span class="text-xs font-medium text-slate-500 dark:text-slate-400 truncate max-w-[5rem]">
              {{ hoveredSegment.label }}
            </span>
            <span class="text-xl font-bold text-slate-900 dark:text-white">
              {{ hoveredSegment.percent }}%
            </span>
          } @else {
            <span class="text-[10px] uppercase tracking-[0.2em] text-slate-500 dark:text-slate-400">
              Total
            </span>
            <span class="text-base font-semibold text-slate-900 dark:text-white">
              {{ formatValue(total) }}
            </span>
          }
        </div>
      </div>

      <!-- Legend -->
      <ul class="flex flex-col gap-2 text-sm w-full max-w-xs">
        @for (item of items; track item.label) {
          <li class="flex items-center justify-between gap-3 rounded-xl border border-slate-200/60 bg-white/70 px-3 py-2 dark:border-slate-800/70 dark:bg-slate-900/60">
            <div class="flex items-center gap-2 min-w-0">
              <span
                class="h-2.5 w-2.5 rounded-full flex-shrink-0"
                [style.backgroundColor]="item.color"
              ></span>
              <span class="text-slate-600 dark:text-slate-300 truncate">{{ item.label }}</span>
            </div>
            <span class="font-semibold text-slate-900 dark:text-white flex-shrink-0">
              {{ item.percent }}%
            </span>
          </li>
        }
      </ul>
    </div>
  }
</article>
